<?xml version="1.0" encoding="UTF-8" ?>
<!--<!DOCTYPE entity-mappings  PUBLIC-->
<!--            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"-->
<!--            "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">-->
<entity-mappings xmlns="http://xmlns.jcp.org/xml/ns/persistence/orm"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence/orm
    http://xmlns.jcp.org/xml/ns/persistence/orm_2_2.xsd" version="2.2">

    <!-- 分页查询主表数据 -->
    <named-query name="CalculatorRepo.pageQuery">
        <query>
            select c from CalculatorVO c
            left join fetch c.pkLimitPlan l
            left join fetch c.pkDept d
            left join fetch c.pkChecker u
            left join fetch c.pkGrantor pg
            left join fetch c.pkOperator po
            left join fetch c.pkOrg o
            left join fetch c.pkInterrate i
            left join fetch c.pkInterrateDepos pid
            left join fetch c.pkSpecialInterrate psi
            left join fetch c.pkCurrtype pc
            left join fetch c.pkCustomer pcu
            order by c.ts desc
        </query>
    </named-query>
    <!-- 查数量 -->
    <named-query name="CalculatorRepo.pageQuery.count">
        <query>
            select count(c.pkLeaseCalculator) from CalculatorVO c
        </query>
    </named-query>

    <!-- 分页查询子表数据 -->
    <!--<named-query name="CalculatorRepo.listChild">-->
        <!--<query>-->
            <!--select c from CalculatorChildDTO c-->
            <!--where c.pkLeaseCalculator =:pk-->
        <!--</query>-->
    <!--</named-query>-->

    <!-- //解决n+1问题 -->
    <named-query name="CalculatorRepo.findByPk">
        <query>
            select c from CalculatorVO c
            left join fetch c.pkLimitPlan l
            left join fetch c.pkDept d
            left join fetch c.pkChecker u
            left join fetch c.pkGrantor pg
            left join fetch c.pkOrg o
            left join fetch c.pkInterrate i
            left join fetch c.pkInterrateDepos pid
            left join fetch c.pkSpecialInterrate psi
            left join fetch c.pkCurrtype pc
            where c.pkLeaseCalculator =:pk
        </query>
    </named-query>

    <!-- //自定义sql -->
    <named-query name="CalculatorRepo.findByIsSql">
        <query>
            select new com.leasing.common.entity.calculate.dto.CalculatorDTO
            (l.pkLeaseCalculator as pkLeaseCalculator, u.pkUser as quotCode, u.userName as quotName )
            from CalculatorVO l, UserVO u
            where l.pkChecker = u.pkUser
            and l.pkLeaseCalculator =:pk
        </query>
    </named-query>

    <!-- 查询 投放计划 字表数据Map -->
    <named-native-query name="CalculatorRepo.findChildById" result-set-mapping="findChildById">
        <query>
            select l.pk_Lease_Calculator as pkLeaseCalculator, l.pk_Currtype as pkCurrtype,
            l.total_Amount_Equipment as totalAmountEquipment, l.ts as ts
            from yls_lease_calculator l
            where l.sourceBill =:sourceBill
        </query>
    </named-native-query>

    <!-- 查询字表数据Map -->
    <sql-result-set-mapping name="findChildById">
        <column-result name="pkLeaseCalculator"></column-result>
        <column-result name="pkCurrtype"></column-result>
        <column-result name="totalAmountEquipment"></column-result>
        <column-result name="ts"></column-result>
    </sql-result-set-mapping>

    <!-- 解决n+1问题 查询列表主表VO -->
    <named-query name="CalculatorRepo.findListByPk">
        <query>
            select c from CalculatorVO c
            left join fetch c.pkLimitPlan l
            left join fetch c.pkDept d
            left join fetch c.pkChecker u
            left join fetch c.pkOrg o
            where c.pkLeaseCalculator =:pk
        </query>
    </named-query>

</entity-mappings>